---
name: CI

on:
  push:
    branches:
      - main

jobs:
  validate-workflows:
    name: Validate Workflows
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Validate GitHub Workflows
        uses: ./actions/validate-schema
        with:
          working-directory: .github/workflows
          schema: github-workflow

  validate-actions:
    name: Validate Actions
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Validate GitHub Actions
        uses: ./actions/validate-schema
        with:
          working-directory: actions
          schema: github-action
          file-pattern: 'action\.ya?ml$'

  release:
    name: Semantic Release
    runs-on: ubuntu-latest
    needs: [validate-workflows, validate-actions]
    permissions:
      contents: write
      pull-requests: write
      issues: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Semantic Release
        id: release
        uses: ./actions/semantic-release
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          should-create-release: 'true'

      - name: Release Version
        if: steps.release.outputs.version != ''
        run: echo "Released version ${{ steps.release.outputs.version }}"